# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# POLITECH AWARDS 2026 â€” PR VOTING WORKFLOW
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# How it works:
#   1. PR is marked "Ready for review" â€” voting comment posted with 48hr deadline
#   2. Committee members (CODEOWNERS) vote via emoji reactions on the comment
#   3. Majority of those who vote wins (abstentions don't count)
#   4. PR author counts as a YES vote only if they're in CODEOWNERS
#   5. At 24h: reminder to non-voters (if you don't vote, this may pass without you)
#   6. At 48h: resolve â€” yes > no â†’ approve, no > yes â†’ reject
#
# Voting (react to the bot's voting comment):
#   ðŸ‘ = YES vote
#   ðŸ‘Ž = NO vote
#   No reaction = ABSTAIN (not counted; PR may pass by majority of those who vote)
#
# Labels applied automatically:
#   vote:pending          â€” Waiting for votes
#   vote:approved         â€” Majority said yes
#   vote:rejected         â€” Majority said no
#   vote:deadline-passed  â€” 48 hours elapsed
#   ready-to-merge        â€” Approved and ready for manual merge
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: PR Voting

on:
  pull_request:
    types: [opened, ready_for_review]
  pull_request_target:
    types: [labeled]
  issue_comment:
    types: [created]
  schedule:
    - cron: "0 12 * * *"

permissions:
  pull-requests: write
  contents: read

jobs:
  notify:
    if: >
      (github.event.action == 'opened' && github.event.pull_request.draft == false) ||
      github.event.action == 'ready_for_review' ||
      (github.event.action == 'labeled' && github.event.label.name == 'start-vote')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: "20"
      - run: npm install
      - run: npx tsx scripts/voting-bot.ts notify ${{ github.event.pull_request.number || github.event.issue.number }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_REPOSITORY: ${{ github.repository }}

  tally:
    if: github.event_name == 'issue_comment' && github.event.issue.pull_request
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: "20"
      - run: npm install
      - run: npx tsx scripts/voting-bot.ts tally ${{ github.event.issue.number }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_REPOSITORY: ${{ github.repository }}

  deadline:
    if: github.event_name == 'schedule'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: "20"
      - run: npm install
      - run: npx tsx scripts/voting-bot.ts deadline
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_REPOSITORY: ${{ github.repository }}
